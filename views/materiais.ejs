<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Gestão de Materiais - EcoCleanSystem</title>
  <link rel="stylesheet" href="/css/layout.css" />
  <link rel="stylesheet" href="/css/nav.css" />
  <link rel="stylesheet" href="/css/materiais.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <%- include('partials/nav', { activePage: activePage || 'materiais', usuario: usuario }) %>

  <main class="main-container container">
    <section class="materiais-section">
      <h1>Materiais</h1>

      <% if (typeof error !== 'undefined' && error) { %>
        <div class="error-message"><%= error %></div>
      <% } %>

      <% if (typeof sucesso !== 'undefined' && sucesso) { %>
        <div class="success-message"><%= sucesso %></div>
      <% } %>

      <!-- FORMULÁRIO: cria ou edita conforme editMaterial (checagem segura) -->
      <section class="criar-material">
        <% if (typeof editMaterial !== 'undefined' && editMaterial) { %>
          <form action="/materiais/atualizar/<%= editMaterial.id %>" method="POST" class="form-criar-material">
            <div class="input-group">
              <label for="nome">Editar Nome</label>
              <input id="nome" name="nome" type="text" required placeholder="Nome do material" value="<%= editMaterial.nome %>">
            </div>

            <div class="input-group">
              <label for="quantidade">Quantidade</label>
              <input id="quantidade" name="quantidade" type="number" min="0" step="1" placeholder="0" value="<%= typeof editMaterial.quantidade !== 'undefined' ? editMaterial.quantidade : '' %>">
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-salvar">Atualizar</button>
              <a href="/materiais" class="btn-cancel">Cancelar</a>
            </div>
          </form>
        <% } else { %>
          <form action="/materiais/criar" method="POST" class="form-criar-material">
            <div class="input-group">
              <label for="nome">Nome</label>
              <input id="nome" name="nome" type="text" required placeholder="Nome do material" value="<%= typeof nome !== 'undefined' ? nome : '' %>">
            </div>

            <div class="input-group">
              <label for="quantidade">Quantidade</label>
              <input id="quantidade" name="quantidade" type="number" min="0" step="1" placeholder="0" value="<%= typeof quantidade !== 'undefined' ? quantidade : '' %>">
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-salvar">Adicionar</button>
            </div>
          </form>
        <% } %>
      </section>

      <!-- TABELA DE MATERIAIS -->
      <% if (Array.isArray(materiais) && materiais.length > 0) { %>
        <div class="tabela-container">
          <table class="tabela-materiais">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Quantidade</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% materiais.forEach(function(mat) { %>
                <tr>
                  <td><%= mat.nome %></td>
                  <td><%= typeof mat.quantidade !== 'undefined' ? mat.quantidade : '' %></td>
                  <td class="acoes-cell">
                    <a class="btn-editar btn-acao" href="/materiais/editar/<%= mat.id %>">Editar</a>
                    <form method="POST" action="/materiais/excluir/<%= mat.id %>" style="display:inline;">
                      <button type="submit" class="btn-excluir btn-acao" onclick="return confirm('Confirma exclusão deste material?')">Excluir</button>
                    </form>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="empty-message">Nenhum material cadastrado.</div>
      <% } %>
    </section>
  </main>
</body>
</html>
